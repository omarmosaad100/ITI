USE SD


sp_addtype loc, 'nchar(2)'

CREATE DEFAULT def1 AS 'NY'

CREATE RULE r1 AS @x IN ('NY','DS','KW')


sp_bindrule r1, loc

sp_bindefault def1, loc


CREATE TABLE Department (
	DeptNo NCHAR(10) PRIMARY KEY,
	DeptName varchar(255) NOT NULL,
	Location loc
)

INSERT INTO Department
VALUES ('d1', 'Research', 'DS');

INSERT INTO Department
VALUES ('d2', 'Accounting', 'KW');

INSERT INTO Department (DeptNo, DeptName)
VALUES ('d3', 'Marketing');

...........

CREATE TABLE Employee (
	EmpNo INT,
	EmpFname VARCHAR(50) NOT NULL,
	EmpLname VARCHAR(50) NOT NULL,
	DeptNo NCHAR(10),
	Salary MONEY,
	CONSTRAINT c1 PRIMARY KEY(EmpNo),
	CONSTRAINT c2 FOREIGN KEY (DeptNo) references Department(DeptNo),
	CONSTRAINT c3 UNIQUE (Salary),
	CONSTRAINT c4 CHECK (EmpFname IS NOT NULL),
	CONSTRAINT c5 CHECK (EmpLname IS NOT NULL),
)

CREATE RULE r2 AS @x < 6000

sp_bindrule r2, 'Employee.Salary'

INSERT INTO Employee
VALUES ('25348', 'Mathew', 'Smith', 'd3', '2500');

INSERT INTO Employee
VALUES ('10102', 'Ann', 'Jones', 'd3', '3000');

INSERT INTO Employee
VALUES ('18316', 'John', 'Barrimore', 'd1', '2400');


INSERT INTO Project
VALUES ('p1', 'Apollo', '120000');

INSERT INTO Project
VALUES ('p2', 'Gemini', '95000');

INSERT INTO Project
VALUES ('p3', 'Mercury', '185600');

.....................


INSERT INTO WorksOn
(EmpNo, ProjectNo, Job)
VALUES ('11111', 'p1', 'Farmer');


UPDATE WorksOn
SET EmpNo = 11111
WHERE EmpNo = 10102

UPDATE Employee
SET EmpNo = 22222
WHERE EmpNo = 10102


DELETE
FROM Employee
WHERE EmpNo = 10102


ALTER TABLE Employee
ADD TelephoneNumber INT;


ALTER TABLE Employee
DROP COLUMN TelephoneNumber;



CREATE SCHEMA COMPANY
ALTER SCHEMA COMPANY TRANSFER Department


CREATE SCHEMA Resource
ALTER SCHEMA Resource TRANSFER Employee


SP_HELP 'Resource.Employee'

CREATE SYNONYM Emp FOR Resource.Employee

Select * from Employee
Select * from Resource.Employee
Select * from Emp
Select * from Resource.Emp


UPDATE Company.Project
SET Budget *= 1.1
WHERE ProjectNo = (select projectNo from WorksOn where EmpNo = 10102 AND JOB LIKE 'Manager')


UPDATE COMPANY.Department
SET DeptName = 'Sales'

WHERE DeptName = 

(SELECT DeptName FROM COMPANY.Department WHERE DeptNo =

(SELECT DeptNo FROM Emp WHERE EmpFName = 'James'))


UPDATE WorksOn
SET Enter_Date = '12/12/2007'
	WHERE ProjectNo = 'p1' AND EmpNo in 
	(SELECT EmpNo FROM Emp, Company.Department WHERE DeptNo = DeptNo AND Deptname LIKE 'Sales'




DELETE
FROM WorksOn
WHERE EmpNo in 
	(SELECT EmpNo FROM Emp WHERE DeptNo = 
		(SELECT DeptNo FROM COMPANY.Department WHERE Location = 'KW'))

